<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Simple offline-first personal finance tracker. Track expenses and income, filter by category, export to CSV, and manage your money with beautiful charts. Works completely offline, no internet required.">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">
    <meta name="apple-mobile-web-app-title" content="FinChronicle">
    <meta name="theme-color" content="#0051D5">
    <title>FinChronicle - Track Your Financial Journey</title>

    <!-- PWA Icons -->
    <link rel="icon" type="image/svg+xml" href="./icons/icon.svg">
    <link rel="apple-touch-icon" href="./icons/icon-192.png">
    <link rel="manifest" href="manifest.json">
    <link href="https://cdn.jsdelivr.net/npm/remixicon@4.0.0/fonts/remixicon.css" rel="stylesheet" integrity="sha384-RwhG+8423fpoSoUMjpibFzMxLQeaO7oBV45/+IxuLaxxiUOFL9R+OzbK5rBpSazc" crossorigin="anonymous">

    <!-- External Stylesheets -->
    <link rel="stylesheet" href="./css/styles.css">
    <link rel="stylesheet" href="./css/dark-mode.css">
</head>
<body>
    <!-- Success Message -->
    <div class="success-message" id="successMessage">Transaction saved!</div>

    <!-- Delete Confirmation Modal -->
    <div class="modal" id="deleteModal">
        <div class="modal-content">
            <div class="modal-title">Delete Transaction?</div>
            <div class="modal-text">This action cannot be undone.</div>
            <div class="modal-actions">
                <button class="modal-btn modal-btn-cancel" data-action="cancel-delete">Cancel</button>
                <button class="modal-btn modal-btn-confirm" data-action="confirm-delete">Delete</button>
            </div>
        </div>
    </div>

    <div class="container">
        <!-- Header -->
        <header>
            <h1>
                <span><i class="ri-wallet-3-line"></i> FinChronicle</span>
                <span class="version" id="appVersion">v3.2.1</span>
            </h1>
            <div class="status">Offline Ready</div>
        </header>

        <!-- Main Content -->
        <main>

        <!-- Update Available Notification -->
        <div class="update-prompt" id="updatePrompt">
            <h3><i class="ri-sparkling-line"></i> Update Available!</h3>
            <p>A new version is available. Reload to get the latest features and improvements.</p>
            <div class="update-actions">
                <button class="update-btn-primary" data-action="reload-app">Update Now</button>
                <button class="update-btn-secondary" data-action="dismiss-update">Later</button>
            </div>
        </div>

        <!-- Install Prompt (iOS) -->
        <div class="install-prompt" id="installPrompt" style="display: none;">
            <h3><i class="ri-smartphone-line"></i> Install App</h3>
            <p>Tap Share → Add to Home Screen for best experience</p>
            <button data-action="hide-install-prompt">Got it!</button>
        </div>

        <!-- Summary Cards -->
        <div class="summary">
            <div class="summary-card">
                <div class="summary-label">This Month</div>
                <div class="summary-value" id="monthNet">0</div>
            </div>
            <div class="summary-card">
                <div class="summary-label">Total Entries</div>
                <div class="summary-value" id="totalEntries">0</div>
            </div>
            <div class="summary-card">
                <div class="summary-label">Income</div>
                <div class="summary-value positive" id="monthIncome">0</div>
            </div>
            <div class="summary-card">
                <div class="summary-label">Expenses</div>
                <div class="summary-value negative" id="monthExpense">0</div>
            </div>
        </div>

        <!-- Toolbar -->
        <div class="toolbar">
            <button class="toolbar-btn" data-action="export-csv" aria-label="Export CSV">
                <i class="ri-download-2-line"></i>
                <span>Export CSV</span>
            </button>
            <button class="toolbar-btn" data-action="check-updates" aria-label="Check for updates" id="updateCheckBtn">
                <i class="ri-refresh-line"></i>
            </button>
            <div class="toolbar-spacer"></div>
            <button class="toolbar-btn" data-action="toggle-currency" aria-label="Change currency" id="currencyBtn">
                <span id="currencySymbol">₹</span>
                <span id="currencyCode">INR</span>
            </button>
            <button class="toolbar-btn" data-action="toggle-dark-mode" aria-label="Toggle dark mode" id="darkModeBtn">
                <i class="ri-moon-line" id="darkModeIcon"></i>
            </button>
        </div>

        <!-- Currency Selector Modal -->
        <div id="currencyModal" class="modal" style="display: none;">
            <div class="modal-content">
                <div class="modal-header">
                    <h3>Select Currency</h3>
                    <button class="close-btn" data-action="close-currency" aria-label="Close"><i class="ri-close-line"></i></button>
                </div>
                <div class="currency-list" id="currencyList">
                    <!-- Currency options will be populated by JavaScript -->
                </div>
            </div>
        </div>

        <!-- Tab Navigation -->
        <div class="tabs" role="tablist" aria-label="Main navigation">
            <button id="add-tab" class="tab active" data-action="switch-tab" data-params='{"tab":"add"}' role="tab" aria-selected="true" aria-controls="addTab"><i class="ri-add-line"></i> Add</button>
            <button id="list-tab" class="tab" data-action="switch-tab" data-params='{"tab":"list"}' role="tab" aria-selected="false" aria-controls="listTab"><i class="ri-list-check"></i> List</button>
            <button id="groups-tab" class="tab" data-action="switch-tab" data-params='{"tab":"groups"}' role="tab" aria-selected="false" aria-controls="groupsTab"><i class="ri-bar-chart-2-line"></i> Groups</button>
        </div>

        <!-- Add Transaction Tab -->
        <div id="addTab" class="tab-content active" role="tabpanel" aria-labelledby="add-tab">
            <div class="card">
                <h2 id="formTitle" style="font-size: 20px; margin-bottom: 16px;">Add Transaction</h2>
                <form id="transactionForm" aria-label="Add transaction form">
                    <div class="form-group">
                        <label>Type</label>
                        <div class="type-toggle" role="radiogroup" aria-label="Transaction type">
                            <button type="button" class="type-option active" data-type="expense" data-action="select-type" data-params='{"type":"expense"}' role="radio" aria-checked="true">
                                <i class="ri-arrow-down-circle-line"></i> Expense
                            </button>
                            <button type="button" class="type-option" data-type="income" data-action="select-type" data-params='{"type":"income"}' role="radio" aria-checked="false">
                                <i class="ri-arrow-up-circle-line"></i> Income
                            </button>
                        </div>
                        <input type="hidden" id="type" value="expense">
                    </div>

                    <div class="form-group">
                        <label for="amount">Amount (₹)</label>
                        <input type="number" id="amount" placeholder="1000" required min="0" step="0.01">
                    </div>

                    <div class="form-group">
                        <label for="category">Category</label>
                        <select id="category" required>
                            <option value="" disabled selected>Select category</option>
                            <!-- Categories will be populated dynamically -->
                        </select>
                    </div>

                    <div class="form-group">
                        <label for="date">Date</label>
                        <input type="date" id="date" required>
                    </div>

                    <div class="form-group">
                        <label for="notes">Notes (Optional)</label>
                        <input type="text" id="notes" placeholder="Add a note...">
                    </div>

                    <input type="hidden" id="editId" value="">

                    <button type="submit" class="primary" id="submitBtn">Save Transaction</button>
                    <button type="button" class="primary" id="cancelEditBtn" data-action="cancel-edit"
                            style="background: #6e6e73; margin-top: 12px; display: none;">Cancel</button>
                </form>
            </div>
        </div>

        <!-- List Tab -->
        <div id="listTab" class="tab-content" role="tabpanel" aria-labelledby="list-tab">
            <div class="filters" id="monthFilters"></div>
            <div style="margin-bottom: 16px;">
                <label for="categoryFilter" style="display: block; font-size: 14px; color: #6e6e73; margin-bottom: 8px; font-weight: 500;">Filter by Category</label>
                <select class="category-filter" id="categoryFilter" aria-label="Filter transactions by category">
                    <option value="all">All Categories</option>
                </select>
            </div>
            <div class="card">
                <div id="transactionsList"></div>
            </div>
        </div>

        <!-- Groups Tab -->
        <div id="groupsTab" class="tab-content" role="tabpanel" aria-labelledby="groups-tab">
            <div class="filters">
                <button class="filter-btn active" data-action="change-grouping" data-params='{"type":"month"}'>By Month</button>
                <button class="filter-btn" data-action="change-grouping" data-params='{"type":"category"}'>By Category</button>
            </div>
            <div id="groupedContent"></div>
        </div>
        </main>
    </div>

    <!-- Load modular JavaScript -->
    <script type="module" src="./js/app.js"></script>
</body>
</html>
